<Window x:Class="ExcelComparerCB.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ExcelComparerCB"
        mc:Ignorable="d"
        Title="Excel Diff (MVP)" Height="720" Width="1200">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="8"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top controls -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <GroupBox Header="Archivo A" Grid.Column="0" Padding="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="TxtFileA" VerticalAlignment="Center" />
                    <Button Grid.Column="2" Content="..." Width="34" Click="BtnBrowseA_Click"/>
                </Grid>
            </GroupBox>

            <GroupBox Header="Archivo B" Grid.Column="2" Padding="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="TxtFileB" VerticalAlignment="Center" />
                    <Button Grid.Column="2" Content="..." Width="34" Click="BtnBrowseB_Click"/>
                </Grid>
            </GroupBox>
        </Grid>

        <!-- Main -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <DockPanel Grid.Column="0">
                <StackPanel DockPanel.Dock="Top" Orientation="Vertical" Margin="0,0,0,8">
                    <WrapPanel>
                        <CheckBox x:Name="ChkCompareValues" Content="Valores" IsChecked="True" Margin="0,0,10,0"/>
                        <CheckBox x:Name="ChkCompareFormulas" Content="Fórmulas" IsChecked="True" Margin="0,0,10,0"/>
                        <CheckBox x:Name="ChkIncludeHiddenSheets" Content="Incluir hojas ocultas" IsChecked="True"/>
                    </WrapPanel>

                    <WrapPanel Margin="0,8,0,0">
                        <Button x:Name="BtnCompare" Content="Comparar" Width="110" Click="BtnCompare_Click"/>
                        <Button x:Name="BtnCancel" Content="Cancelar" Width="110" Margin="8,0,0,0" IsEnabled="False" Click="BtnCancel_Click"/>
                    </WrapPanel>

                    <TextBlock x:Name="TxtStatus" Margin="0,8,0,0" Text="Listo."/>
                    <ProgressBar x:Name="Prog" Height="16" Margin="0,4,0,0" Minimum="0" Maximum="100"/>
                </StackPanel>

                <GroupBox Header="Resumen" DockPanel.Dock="Bottom">
                    <TreeView x:Name="TreeSummary" SelectedItemChanged="TreeSummary_SelectedItemChanged" />
                </GroupBox>
            </DockPanel>

            <GroupBox Grid.Column="2" Header="Diferencias">
                <DockPanel>
                    <TextBox x:Name="TxtFilter" DockPanel.Dock="Top" Margin="6" Height="26"
                             TextChanged="TxtFilter_TextChanged"/>
                    <DataGrid x:Name="GridDiffs" Margin="6" AutoGenerateColumns="False" IsReadOnly="True"
                              CanUserAddRows="False" SelectionMode="Single"
                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                              AlternatingRowBackground="#FFF5F5F5" AlternationCount="2"
                              RowHeaderWidth="0">
                        <DataGrid.Resources>
                            <Style x:Key="WrapCell" TargetType="TextBlock">
                                <Setter Property="TextWrapping" Value="Wrap"/>
                                <Setter Property="Padding" Value="2"/>
                            </Style>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Sheet" Binding="{Binding Sheet}" Width="140" ElementStyle="{StaticResource WrapCell}"/>
                            <DataGridTextColumn Header="Address" Binding="{Binding Address}" Width="90" ElementStyle="{StaticResource WrapCell}"/>
                            <DataGridTextColumn Header="Kind" Binding="{Binding Kind}" Width="90" ElementStyle="{StaticResource WrapCell}"/>
                            <DataGridTextColumn Header="What" Binding="{Binding What}" Width="150" ElementStyle="{StaticResource WrapCell}"/>
                            <DataGridTextColumn Header="Before" Binding="{Binding Before}" Width="*" ElementStyle="{StaticResource WrapCell}"/>
                            <DataGridTextColumn Header="After" Binding="{Binding After}" Width="*" ElementStyle="{StaticResource WrapCell}"/>
                        </DataGrid.Columns>
                        <DataGrid.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.HeaderTemplate>
                                    <DataTemplate>
                                        <TextBlock FontWeight="Bold" Background="#FFEFEFEF" Padding="4" Text="{Binding Name}"/>
                                    </DataTemplate>
                                </GroupStyle.HeaderTemplate>
                                <GroupStyle.Panel>
                                    <ItemsPanelTemplate>
                                        <DataGridRowsPresenter/>
                                    </ItemsPanelTemplate>
                                </GroupStyle.Panel>
                            </GroupStyle>
                        </DataGrid.GroupStyle>
                    </DataGrid>
                </DockPanel>
            </GroupBox>
        </Grid>

        <TextBlock Grid.Row="3" Margin="0,10,0,0" Foreground="Gray"
                   Text="MVP: compara hojas (add/remove/hidden) + celdas (valor/fórmula). OpenXML no recalcula fórmulas."/>
    </Grid>
</Window>
